{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap c1797e29b716f4cc37a2","webpack:///./src/backoff.js","webpack:///./src/index.js"],"names":["randomBetween","min","max","Math","floor","random","Backoff","initialDelayMillis","maxDelayMillis","randomBetweenFunc","_initialDelay","_maxDelay","_nextDelay","_randomBetween","delay","READYSTATE","CONNECTING","OPEN","CLOSING","CLOSED","defaultOptions","debug","initialBackoffDelayMillis","maxBackoffDelayMillis","pingSendFunction","pingIntervalSeconds","pingTimeoutMillis","connectTimeoutMillis","reachabilityTestUrl","noop","AttemptReconnectEvent","attemptNumber","waitMillis","PersistentWebsocket","url","protocols","options","undefined","onopen","onclose","onmessage","onerror","onbeforereconnect","_url","_protocols","_options","Object","assign","_backoff","_waitingForPong","_manuallyClosed","_hasConnected","_retryCount","_pingTimeoutId","_scheduledReconnectTimeoutId","_websocketConnectionCheckTimeoutId","_reachabilityCheckTimeoutId","WebSocket","XMLHttpRequest","_debugLog","ws","_createWebsocket","_binaryType","binaryType","_onWebsocketClose","bind","_onWebsocketError","_onWebsocketMessage","_onWebsocketOpen","_websocket","_scheduleWebsocketConnectionCheck","event","wasExpected","_checkReachabilityAndScheduleReconnect","_schedulePing","wasReconnect","target","readyState","_cancelWebsocketConnectionCheck","setTimeout","_checkPingResult","_cancelPing","_sendPing","clearTimeout","close","_scheduleReconnect","xhr","_createXhr","addEventListener","reset","open","send","nextDelay","_openWebsocket","_checkWebsocketConnection","message","console","code","reason","_cancelScheduledReconnect","_cancelReachabilityCheck","data","bufferedAmount","extensions","val"],"mappings":"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","file":"persistentwebsocket.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"persistentwebsocket\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"persistentwebsocket\"] = factory();\n\telse\n\t\troot[\"persistentwebsocket\"] = factory();\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c1797e29b716f4cc37a2","/**\n * Backoff based on \"Decorrelated jitter\" algorithm on https://www.awsarchitectureblog.com/2015/03/backoff.html\n */\n\nfunction randomBetween(min, max) {\n  return Math.floor(Math.random() * (max - min)) + min\n}\n\nexport default class Backoff {\n  constructor(initialDelayMillis, maxDelayMillis, randomBetweenFunc = randomBetween) {\n    this._initialDelay = initialDelayMillis;\n    this._maxDelay = maxDelayMillis;\n    this._nextDelay = this._initialDelay;\n    this._randomBetween = randomBetweenFunc;\n  }\n\n  reset() {\n    this._nextDelay = this._initialDelay;\n  }\n\n  nextDelay() {\n    const delay = this._nextDelay;\n    this._nextDelay = Math.min(\n      this._maxDelay,\n      this._randomBetween(this._initialDelay, delay * 3),\n    );\n    return delay;\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/backoff.js","import Backoff from \"./backoff\";\n\nexport const READYSTATE = {\n  CONNECTING: 0,\n  OPEN: 1,\n  CLOSING: 2,\n  CLOSED: 3\n};\n\nconst defaultOptions = {\n  debug: false,\n  initialBackoffDelayMillis: 500,\n  maxBackoffDelayMillis: 120000,\n  pingSendFunction: null, // Function that takes the PersistentWebsocket instance as its only parameter\n  pingIntervalSeconds: 30,\n  pingTimeoutMillis: 2000,\n  connectTimeoutMillis: 3000,\n  reachabilityTestUrl: null,\n};\n\nfunction noop() {\n}\n\nexport class AttemptReconnectEvent {\n  constructor(attemptNumber, waitMillis) {\n    this.attemptNumber = attemptNumber;\n    this.waitMillis = waitMillis;\n  }\n}\n\nexport class PersistentWebsocket {\n  constructor(url, protocols, options = {}) {\n    if (typeof(protocols) === \"object\") {\n      options = protocols;\n      protocols = undefined;\n    }\n\n    this.onopen = noop;\n    this.onclose = noop;\n    this.onmessage = noop;\n    this.onerror = noop;\n    this.onbeforereconnect = noop;\n\n    this._url = url;\n    this._protocols = protocols;\n    this._options = Object.assign({}, defaultOptions, options);\n    this._backoff = new Backoff(this._options.initialBackoffDelayMillis, this._options.maxBackoffDelayMillis);\n    this._waitingForPong = false;\n    this._manuallyClosed = false;\n    this._hasConnected = false;\n    this._retryCount = 0;\n\n    this._pingTimeoutId = 0;\n    this._scheduledReconnectTimeoutId = 0;\n    this._websocketConnectionCheckTimeoutId = 0;\n    this._reachabilityCheckTimeoutId = 0;\n  }\n\n  _createWebsocket(url, protocols) {\n    return new WebSocket(url, protocols);\n  }\n\n  _createXhr() {\n    return new XMLHttpRequest();\n  }\n\n  _openWebsocket() {\n    this._debugLog(\"Trying to open websocket\");\n    const ws = this._createWebsocket(this._url, this._protocols);\n    if (this._binaryType) {\n      ws.binaryType = this._binaryType;\n    }\n    ws.onclose = this._onWebsocketClose.bind(this);\n    ws.onerror = this._onWebsocketError.bind(this);\n    ws.onmessage = this._onWebsocketMessage.bind(this);\n    ws.onopen = this._onWebsocketOpen.bind(this);\n    this._websocket = ws;\n\n    this._scheduleWebsocketConnectionCheck();\n  }\n\n  _onWebsocketClose(event) {\n    event.wasExpected = this._manuallyClosed;\n    this.onclose(event);\n    if (!this._manuallyClosed) {\n      this._checkReachabilityAndScheduleReconnect();\n    }\n  }\n\n  _onWebsocketError(event) {\n    this.onerror(event);\n  }\n\n  _onWebsocketMessage(event) {\n    // Any message counts as a \"pong\"\n    this._waitingForPong = false;\n\n    // Reschedule ping so pings only occur when the inbound side of the connection is quiet for ${pingIntervalSeconds}\n    this._schedulePing();\n\n    this.onmessage(event);\n  }\n\n  _onWebsocketOpen(event) {\n    event.wasReconnect = this._hasConnected;\n    this.onopen(event);\n    this._hasConnected = true;\n    this._retryCount = 0;\n\n    if (event.target.readyState == READYSTATE.OPEN) {\n      // Start pings\n      this._schedulePing();\n      this._cancelWebsocketConnectionCheck();\n    }\n  }\n\n  _sendPing() {\n    this._debugLog(\"Pinging websocket...\");\n    this._waitingForPong = true;\n    this._options.pingSendFunction(this);\n    setTimeout(this._checkPingResult.bind(this), this._options.pingTimeoutMillis);\n  }\n\n  _schedulePing() {\n    // Always clear out any existing scheduled pings\n    if (this._pingTimeoutId) {\n      this._cancelPing();\n    }\n\n    const {pingSendFunction, pingIntervalSeconds} = this._options;\n    if (pingSendFunction && pingIntervalSeconds) {\n      this._pingTimeoutId = setTimeout(this._sendPing.bind(this), pingIntervalSeconds * 1000);\n    }\n  }\n\n  _cancelPing() {\n    clearTimeout(this._pingTimeoutId);\n    this._pingTimeoutId = 0;\n  }\n\n  _checkPingResult() {\n    if (this._waitingForPong) {\n      this._debugLog(\"Closing websocket due to ping failure.\");\n      this._websocket.close(4001, \"Closing websocket due to ping failure.\");\n    }\n  }\n\n  _checkReachabilityAndScheduleReconnect() {\n    if (!this._options.reachabilityTestUrl) {\n      this._scheduleReconnect();\n    } else {\n      const xhr = this._createXhr();\n      xhr.addEventListener(\"load\", () => {\n        this._reachabilityCheckTimeoutId = 0;\n        this._debugLog(`ONLINE: HEAD request to ${this._options.reachabilityTestUrl} succeeded.`);\n        this._scheduleReconnect();\n      });\n      xhr.addEventListener(\"error\", () => {\n        // Check if online again in 3 seconds\n        this._debugLog(`OFFLINE: Unable to reach ${this._options.reachabilityTestUrl}.\\nTrying again in 3s.`);\n        this._backoff.reset();\n        this._reachabilityCheckTimeoutId = setTimeout(this._checkReachabilityAndScheduleReconnect.bind(this), 3000);\n      });\n      xhr.open(\"HEAD\", this._options.reachabilityTestUrl);\n      xhr.send();\n    }\n  }\n\n  _cancelReachabilityCheck() {\n    if (this._reachabilityCheckTimeoutId) {\n      clearTimeout(this._reachabilityCheckTimeoutId);\n      this._reachabilityCheckTimeoutId = 0;\n    }\n  }\n\n  _scheduleReconnect() {\n    const waitMillis = this._backoff.nextDelay();\n    this._retryCount++;\n    this._debugLog(`Scheduling websocket reconnect attempt ${this._retryCount} in ${waitMillis}ms`);\n    this.onbeforereconnect(new AttemptReconnectEvent(this._retryCount, waitMillis));\n\n    this._scheduledReconnectTimeoutId = setTimeout(this._openWebsocket.bind(this), waitMillis);\n  }\n\n  _cancelScheduledReconnect() {\n    if (this._scheduledReconnectTimeoutId) {\n      clearTimeout(this._scheduledReconnectTimeoutId);\n      this._scheduledReconnectTimeoutId = 0;\n    }\n  }\n\n  _scheduleWebsocketConnectionCheck() {\n    setTimeout(this._checkWebsocketConnection.bind(this), this._options.connectTimeoutMillis);\n  }\n\n  _cancelWebsocketConnectionCheck() {\n    if (this._websocketConnectionCheckTimeoutId) {\n      clearTimeout(this._websocketConnectionCheckTimeoutId);\n      this._websocketConnectionCheckTimeoutId = 0;\n    }\n  }\n\n  _checkWebsocketConnection() {\n    this._debugLog(`Checking websocket connection. ReadyState is ${this._websocket.readyState}`);\n    if (this._websocket.readyState === READYSTATE.OPEN) {\n      // Start pings\n      this._schedulePing();\n    } else {\n      this._websocket.close(4000, \"Unable to establish websocket connection before the configured connectTimeoutMillis\");\n    }\n  }\n\n  _debugLog(message) {\n    if (this._options.debug) {\n      console.debug(message);\n    }\n  }\n\n  open() {\n    if (this._websocket) {\n      throw \"Websocket has already been opened\"\n    }\n    this._openWebsocket();\n  }\n\n  // Delegated Websocket stuff\n  close(code, reason) {\n    this._manuallyClosed = true;\n    this._cancelScheduledReconnect();\n    this._cancelWebsocketConnectionCheck();\n    this._cancelReachabilityCheck();\n    this._cancelPing();\n\n    if (!this._websocket) {\n      throw \"Can't close websocket because it was never opened.\";\n    }\n\n    this._websocket.close(code, reason);\n  }\n\n  send(data) {\n    if (!this._websocket) {\n      throw \"Can't send through websocket because it was never opened.\";\n    }\n    this._websocket.send(data);\n  }\n\n  get readyState() {\n    if (!this._websocket) {\n      throw \"Can't get websocket readyState because it was never opened.\";\n    }\n    return this._websocket.readyState;\n  }\n\n  get url() {\n    return this._url;\n  }\n\n  get bufferedAmount() {\n    if (!this._websocket) {\n      throw \"Can't get websocket bufferedAmount because it was never opened.\";\n    }\n    return this._websocket.bufferedAmount;\n  }\n\n  get extensions() {\n    if (!this._websocket) {\n      throw \"Can't get websocket extensions because it was never opened.\";\n    }\n    return this._websocket.extensions;\n  }\n\n  get binaryType() {\n    return this._binaryType;\n  }\n\n  set binaryType(val) {\n    this._binaryType = val;\n    if (this._websocket) {\n      this._websocket.binaryType = val;\n    }\n  }\n\n  get retryCount() {\n    return this._retryCount;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js"],"sourceRoot":""}